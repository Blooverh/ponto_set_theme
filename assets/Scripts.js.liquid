/* Add cart functionality on add to cart click using AJAX */

const addToCartForms = document.querySelectorAll('form[action="/cart/add"]'); // select all add to cart forms

// loop through all add cart forms and add event listener
addToCartForms.forEach((form) => {
    form.addEventListener("submit", async (event) => {
        //prevent normal submission
        event.preventDefault();

        //submit form with AJAX
        await fetch("/cart/add", {
            method: "post",
            body: new FormData(form),
        });

        //Get new cart object
        const objCart =  await fetch("/cart.json");
        const cart = await objCart.json();

        // Update cart count
        // document.querySelectorAll(".cart-count").forEach((el) => {
        //     el.textContent = cart.item_count;
        // });

        const message = document.createElement("p");
        message.classList.add("added-to-cart");
        message.textContent = "Added to cart!";
        form.appendChild(message);
    });
});
